void vp9_lpf_horizontal_4_dual_sse2 ( unsigned char * s , int p , const unsigned char * _blimit0 , const unsigned char * _limit0 , const unsigned char * _thresh0 , const unsigned char * _blimit1 , const unsigned char * _limit1 , const unsigned char * _thresh1 ) {
 const __m128i blimit = _mm_unpacklo_epi64 ( _mm_load_si128 ( ( const __m128i * ) _blimit0 ) , _mm_load_si128 ( ( const __m128i * ) _blimit1 ) ) ;
 const __m128i limit = _mm_unpacklo_epi64 ( _mm_load_si128 ( ( const __m128i * ) _limit0 ) , _mm_load_si128 ( ( const __m128i * ) _limit1 ) ) ;
 const __m128i thresh = _mm_unpacklo_epi64 ( _mm_load_si128 ( ( const __m128i * ) _thresh0 ) , _mm_load_si128 ( ( const __m128i * ) _thresh1 ) ) ;
 const __m128i zero = _mm_set1_epi16 ( 0 ) ;
 __m128i p3 , p2 , p1 , p0 , q0 , q1 , q2 , q3 ;
 __m128i mask , hev , flat ;
 p3 = _mm_loadu_si128 ( ( __m128i * ) ( s - 4 * p ) ) ;
 p2 = _mm_loadu_si128 ( ( __m128i * ) ( s - 3 * p ) ) ;
 p1 = _mm_loadu_si128 ( ( __m128i * ) ( s - 2 * p ) ) ;
 p0 = _mm_loadu_si128 ( ( __m128i * ) ( s - 1 * p ) ) ;
 q0 = _mm_loadu_si128 ( ( __m128i * ) ( s - 0 * p ) ) ;
 q1 = _mm_loadu_si128 ( ( __m128i * ) ( s + 1 * p ) ) ;
 q2 = _mm_loadu_si128 ( ( __m128i * ) ( s + 2 * p ) ) ;
 q3 = _mm_loadu_si128 ( ( __m128i * ) ( s + 3 * p ) ) ;
 {
 const __m128i abs_p1p0 = _mm_or_si128 ( _mm_subs_epu8 ( p1 , p0 ) , _mm_subs_epu8 ( p0 , p1 ) ) ;
 const __m128i abs_q1q0 = _mm_or_si128 ( _mm_subs_epu8 ( q1 , q0 ) , _mm_subs_epu8 ( q0 , q1 ) ) ;
 const __m128i fe = _mm_set1_epi8 ( 0xfe ) ;
 const __m128i ff = _mm_cmpeq_epi8 ( abs_p1p0 , abs_p1p0 ) ;
 __m128i abs_p0q0 = _mm_or_si128 ( _mm_subs_epu8 ( p0 , q0 ) , _mm_subs_epu8 ( q0 , p0 ) ) ;
 __m128i abs_p1q1 = _mm_or_si128 ( _mm_subs_epu8 ( p1 , q1 ) , _mm_subs_epu8 ( q1 , p1 ) ) ;
 __m128i work ;
 flat = _mm_max_epu8 ( abs_p1p0 , abs_q1q0 ) ;
 hev = _mm_subs_epu8 ( flat , thresh ) ;
 hev = _mm_xor_si128 ( _mm_cmpeq_epi8 ( hev , zero ) , ff ) ;
 abs_p0q0 = _mm_adds_epu8 ( abs_p0q0 , abs_p0q0 ) ;
 abs_p1q1 = _mm_srli_epi16 ( _mm_and_si128 ( abs_p1q1 , fe ) , 1 ) ;
 mask = _mm_subs_epu8 ( _mm_adds_epu8 ( abs_p0q0 , abs_p1q1 ) , blimit ) ;
 mask = _mm_xor_si128 ( _mm_cmpeq_epi8 ( mask , zero ) , ff ) ;
 mask = _mm_max_epu8 ( flat , mask ) ;
 work = _mm_max_epu8 ( _mm_or_si128 ( _mm_subs_epu8 ( p2 , p1 ) , _mm_subs_epu8 ( p1 , p2 ) ) , _mm_or_si128 ( _mm_subs_epu8 ( p3 , p2 ) , _mm_subs_epu8 ( p2 , p3 ) ) ) ;
 mask = _mm_max_epu8 ( work , mask ) ;
 work = _mm_max_epu8 ( _mm_or_si128 ( _mm_subs_epu8 ( q2 , q1 ) , _mm_subs_epu8 ( q1 , q2 ) ) , _mm_or_si128 ( _mm_subs_epu8 ( q3 , q2 ) , _mm_subs_epu8 ( q2 , q3 ) ) ) ;
 mask = _mm_max_epu8 ( work , mask ) ;
 mask = _mm_subs_epu8 ( mask , limit ) ;
 mask = _mm_cmpeq_epi8 ( mask , zero ) ;
 }
 {
 const __m128i t4 = _mm_set1_epi8 ( 4 ) ;
 const __m128i t3 = _mm_set1_epi8 ( 3 ) ;
 const __m128i t80 = _mm_set1_epi8 ( 0x80 ) ;
 const __m128i te0 = _mm_set1_epi8 ( 0xe0 ) ;
 const __m128i t1f = _mm_set1_epi8 ( 0x1f ) ;
 const __m128i t1 = _mm_set1_epi8 ( 0x1 ) ;
 const __m128i t7f = _mm_set1_epi8 ( 0x7f ) ;
 const __m128i ps1 = _mm_xor_si128 ( _mm_loadu_si128 ( ( __m128i * ) ( s - 2 * p ) ) , t80 ) ;
 const __m128i ps0 = _mm_xor_si128 ( _mm_loadu_si128 ( ( __m128i * ) ( s - 1 * p ) ) , t80 ) ;
 const __m128i qs0 = _mm_xor_si128 ( _mm_loadu_si128 ( ( __m128i * ) ( s + 0 * p ) ) , t80 ) ;
 const __m128i qs1 = _mm_xor_si128 ( _mm_loadu_si128 ( ( __m128i * ) ( s + 1 * p ) ) , t80 ) ;
 __m128i filt ;
 __m128i work_a ;
 __m128i filter1 , filter2 ;
 filt = _mm_and_si128 ( _mm_subs_epi8 ( ps1 , qs1 ) , hev ) ;
 work_a = _mm_subs_epi8 ( qs0 , ps0 ) ;
 filt = _mm_adds_epi8 ( filt , work_a ) ;
 filt = _mm_adds_epi8 ( filt , work_a ) ;
 filt = _mm_adds_epi8 ( filt , work_a ) ;
 filt = _mm_and_si128 ( filt , mask ) ;
 filter1 = _mm_adds_epi8 ( filt , t4 ) ;
 filter2 = _mm_adds_epi8 ( filt , t3 ) ;
 work_a = _mm_cmpgt_epi8 ( zero , filter1 ) ;
 filter1 = _mm_srli_epi16 ( filter1 , 3 ) ;
 work_a = _mm_and_si128 ( work_a , te0 ) ;
 filter1 = _mm_and_si128 ( filter1 , t1f ) ;
 filter1 = _mm_or_si128 ( filter1 , work_a ) ;
 work_a = _mm_cmpgt_epi8 ( zero , filter2 ) ;
 filter2 = _mm_srli_epi16 ( filter2 , 3 ) ;
 work_a = _mm_and_si128 ( work_a , te0 ) ;
 filter2 = _mm_and_si128 ( filter2 , t1f ) ;
 filter2 = _mm_or_si128 ( filter2 , work_a ) ;
 filt = _mm_adds_epi8 ( filter1 , t1 ) ;
 work_a = _mm_cmpgt_epi8 ( zero , filt ) ;
 filt = _mm_srli_epi16 ( filt , 1 ) ;
 work_a = _mm_and_si128 ( work_a , t80 ) ;
 filt = _mm_and_si128 ( filt , t7f ) ;
 filt = _mm_or_si128 ( filt , work_a ) ;
 filt = _mm_andnot_si128 ( hev , filt ) ;
 q0 = _mm_xor_si128 ( _mm_subs_epi8 ( qs0 , filter1 ) , t80 ) ;
 q1 = _mm_xor_si128 ( _mm_subs_epi8 ( qs1 , filt ) , t80 ) ;
 p0 = _mm_xor_si128 ( _mm_adds_epi8 ( ps0 , filter2 ) , t80 ) ;
 p1 = _mm_xor_si128 ( _mm_adds_epi8 ( ps1 , filt ) , t80 ) ;
 _mm_storeu_si128 ( ( __m128i * ) ( s - 2 * p ) , p1 ) ;
 _mm_storeu_si128 ( ( __m128i * ) ( s - 1 * p ) , p0 ) ;
 _mm_storeu_si128 ( ( __m128i * ) ( s + 0 * p ) , q0 ) ;
 _mm_storeu_si128 ( ( __m128i * ) ( s + 1 * p ) , q1 ) ;
 }
 }